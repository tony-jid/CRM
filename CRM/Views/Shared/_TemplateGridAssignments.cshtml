@using (Html.DevExtreme().NamedTemplate("template-grid-assignments"))
{
    @(Html.DevExtreme().DataGrid<LeadAssignmentViewModel>()
        .CommonConfigs((new JS("templateData.LeadId")).ToString())
        .DataSource(ds => ds.Mvc()
            .Controller(nameof(EnumController.LeadAssignments))
            .LoadAction("Get")
            .LoadParams(new
            {
                leadId = new JS("templateData.LeadId")
            })
            .Key("Id")
        )
        .Columns(c =>
        {
            c.Add().CellTemplate(new TemplateName("template-grid-assignment-column-branch"));
            c.Add().Caption("Status").CellTemplate(new TemplateName("template-grid-assignment-column-status"));
            c.Add().CellTemplate(new TemplateName("template-grid-assignment-column-action"));
        })
        .Editing(e => e
            .Mode(GridEditMode.Popup)
            .UseIcons(true)
            .AllowAdding(false)
            .AllowUpdating(false)
            .AllowDeleting(true)
            .Popup(DXGridConfigs.EditingPopup("LeadAssignment"))
        )
        .OnContentReady("function(e) { CustomGridEvent.onContentReady(e, templateData.LeadId); $('[data-toggle=\"tooltip\"]').tooltip(); }")
        .OnToolbarPreparing("function(e) { CustomGridEvent.onToolbarPreparing(e, templateData.LeadId); }")
        .OnRowRemoved("function(e) { assignment.refreshGridSearchBranches(); }")
    )
}

@using (Html.DevExtreme().NamedTemplate("template-grid-assignment-column-branch"))
{
    <div class="d-flex justify-content-around">
        <img src="<%= data.PartnerLogo %>" class="grid-partner-logo" 
                data-toggle="tooltip" data-placement="bottom" title="<%= data.PartnerName %>"/>

        <span>
            <%= data.PartnerBranchState %>, <%= data.PartnerBranchPostCode %>

            <a data-toggle="tooltip"
                data-placement="bottom"
                data-html="true"
                title="<%= data.PartnerBranchAddress %>">
                    <span class="batch-icon batch-icon-zoom-in-alt text-priamry"></span>
            </a>
        </span>
    </div>
}

@using (Html.DevExtreme().NamedTemplate("template-grid-assignment-column-status"))
{
    <span><%= data.StatusTag %></span>
    <a href="#/" data-toggle="tooltip"
        data-placement="bottom"
        data-html="true"
        title="<%= data.History %>">
        <span class="batch-icon batch-icon-zoom-in-alt text-priamry"></span>
    </a>
}

@using (Html.DevExtreme().NamedTemplate("template-grid-assignment-column-action"))
{
    @(Html.DevExtreme().SelectBox()
        .DataSource(new JS("data.Actions"))
        .ActionCommonConfigs()
    )
}